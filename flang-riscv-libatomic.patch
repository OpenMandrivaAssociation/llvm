diff -up llvm-project-16.0.4.src/flang/CMakeLists.txt.omv~ llvm-project-16.0.4.src/flang/CMakeLists.txt
--- llvm-project-16.0.4.src/flang/CMakeLists.txt.omv~	2023-05-18 07:55:45.977123373 +0200
+++ llvm-project-16.0.4.src/flang/CMakeLists.txt	2023-05-18 07:55:59.955250507 +0200
@@ -6,6 +6,12 @@ endif()
 include(${LLVM_COMMON_CMAKE_UTILS}/Modules/CMakePolicy.cmake
   NO_POLICY_SCOPE)
 
+if("${CMAKE_SYSTEM_PROCESSOR}" STREQUAL "riscv64")
+  set(atomic_libs "atomic")
+else()
+  set(atomic_libs)
+endif()
+
 set(CMAKE_BUILD_WITH_INSTALL_NAME_DIR ON)
 
 # Flang requires C++17.
diff -up llvm-project-16.0.4.src/flang/tools/bbc/CMakeLists.txt.omv~ llvm-project-16.0.4.src/flang/tools/bbc/CMakeLists.txt
--- llvm-project-16.0.4.src/flang/tools/bbc/CMakeLists.txt.omv~	2023-05-18 07:49:26.726638423 +0200
+++ llvm-project-16.0.4.src/flang/tools/bbc/CMakeLists.txt	2023-05-18 07:56:28.068505991 +0200
@@ -25,4 +25,6 @@ FortranParser
 FortranEvaluate
 FortranSemantics
 FortranLower
+LLVMSupport
+${atomic_libs}
 )
diff -up llvm-project-16.0.4.src/flang/tools/fir-opt/CMakeLists.txt.omv~ llvm-project-16.0.4.src/flang/tools/fir-opt/CMakeLists.txt
--- llvm-project-16.0.4.src/flang/tools/fir-opt/CMakeLists.txt.omv~	2023-05-18 07:58:50.081792734 +0200
+++ llvm-project-16.0.4.src/flang/tools/fir-opt/CMakeLists.txt	2023-05-18 07:58:58.394867880 +0200
@@ -34,4 +34,5 @@ target_link_libraries(fir-opt PRIVATE
   MLIRVectorToLLVM
   MLIROptLib
 
+  ${atomic_libs}
 )
diff -up llvm-project-16.0.4.src/flang/tools/flang-driver/CMakeLists.txt.omv~ llvm-project-16.0.4.src/flang/tools/flang-driver/CMakeLists.txt
--- llvm-project-16.0.4.src/flang/tools/flang-driver/CMakeLists.txt.omv~	2023-05-18 07:53:11.757715442 +0200
+++ llvm-project-16.0.4.src/flang/tools/flang-driver/CMakeLists.txt	2023-05-18 07:56:16.219398344 +0200
@@ -28,12 +28,14 @@ target_link_libraries(flang-new
   PRIVATE
   flangFrontend
   flangFrontendTool
+  ${atomic_libs}
 )
 
 clang_target_link_libraries(flang-new
   PRIVATE
   clangDriver
   clangBasic
+  ${atomic_libs}
 )
 
 option(FLANG_PLUGIN_SUPPORT "Build Flang with plugin support." ON)
diff -up llvm-project-16.0.4.src/flang/tools/tco/CMakeLists.txt.omv~ llvm-project-16.0.4.src/flang/tools/tco/CMakeLists.txt
--- llvm-project-16.0.4.src/flang/tools/tco/CMakeLists.txt.omv~	2023-05-18 07:56:33.726557377 +0200
+++ llvm-project-16.0.4.src/flang/tools/tco/CMakeLists.txt	2023-05-18 07:56:41.923631802 +0200
@@ -27,4 +27,5 @@ target_link_libraries(tco PRIVATE
   MLIRParser
   MLIRSupport
   MLIRVectorToLLVM
+  ${atomic_libs}
 )
