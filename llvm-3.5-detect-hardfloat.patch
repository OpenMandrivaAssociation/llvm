--- llvm-3.7.0.src/lib/Support/Triple.cpp.detectHardfloat~	2015-07-07 01:58:14.000000000 +0200
+++ llvm-3.7.0.src/lib/Support/Triple.cpp	2015-07-28 13:21:36.051669080 +0200
@@ -417,8 +417,8 @@ static Triple::OSType parseOS(StringRef
     .Default(Triple::UnknownOS);
 }
 
-static Triple::EnvironmentType parseEnvironment(StringRef EnvironmentName) {
-  return StringSwitch<Triple::EnvironmentType>(EnvironmentName)
+static Triple::EnvironmentType parseEnvironment(StringRef EnvironmentName, StringRef ArchName, StringRef VendorName) {
+  Triple::EnvironmentType t = StringSwitch<Triple::EnvironmentType>(EnvironmentName)
     .StartsWith("eabihf", Triple::EABIHF)
     .StartsWith("eabi", Triple::EABI)
     .StartsWith("gnueabihf", Triple::GNUEABIHF)
@@ -431,6 +431,15 @@ static Triple::EnvironmentType parseEnvi
     .StartsWith("itanium", Triple::Itanium)
     .StartsWith("cygnus", Triple::Cygnus)
     .Default(Triple::UnknownEnvironment);
+  if(t == Triple::GNUEABI) {
+    // There's some special cases where -gnueabi actually means
+    // GNUEABIHF, such as
+    // armv7hl-linux-gnueabi (Fedora) and
+    // armv7a-hardfloat-linux-gnueabi (Gentoo)
+    if(ArchName.find('h') != StringRef::npos || VendorName.equals("hardfloat"))
+      return Triple::GNUEABIHF;
+  }
+  return t;
 }
 
 static Triple::ObjectFormatType parseFormat(StringRef EnvironmentName) {
@@ -554,7 +563,7 @@ Triple::Triple(const Twine &Str)
       SubArch(parseSubArch(getArchName())),
       Vendor(parseVendor(getVendorName())),
       OS(parseOS(getOSName())),
-      Environment(parseEnvironment(getEnvironmentName())),
+      Environment(parseEnvironment(getEnvironmentName(), getArchName(), getVendorName())),
       ObjectFormat(parseFormat(getEnvironmentName())) {
   if (ObjectFormat == Triple::UnknownObjectFormat)
     ObjectFormat = getDefaultFormat(*this);
@@ -589,7 +598,7 @@ Triple::Triple(const Twine &ArchStr, con
       SubArch(parseSubArch(ArchStr.str())),
       Vendor(parseVendor(VendorStr.str())),
       OS(parseOS(OSStr.str())),
-      Environment(parseEnvironment(EnvironmentStr.str())),
+      Environment(parseEnvironment(EnvironmentStr.str(), ArchStr.str(), VendorStr.str())),
       ObjectFormat(parseFormat(EnvironmentStr.str())) {
   if (ObjectFormat == Triple::UnknownObjectFormat)
     ObjectFormat = getDefaultFormat(*this);
@@ -622,7 +631,7 @@ std::string Triple::normalize(StringRef
   }
   EnvironmentType Environment = UnknownEnvironment;
   if (Components.size() > 3)
-    Environment = parseEnvironment(Components[3]);
+    Environment = parseEnvironment(Components[3], Components[0], Components[1]);
   ObjectFormatType ObjectFormat = UnknownObjectFormat;
   if (Components.size() > 4)
     ObjectFormat = parseFormat(Components[4]);
@@ -667,7 +676,7 @@ std::string Triple::normalize(StringRef
         Valid = OS != UnknownOS || IsCygwin || IsMinGW32;
         break;
       case 3:
-        Environment = parseEnvironment(Comp);
+        Environment = parseEnvironment(Comp, Components[0], Components[1]);
         Valid = Environment != UnknownEnvironment;
         if (!Valid) {
           ObjectFormat = parseFormat(Comp);
--- llvm-3.7.0.src/tools/clang/lib/Driver/Tools.cpp.detectHardfloat~	2015-07-28 13:21:36.025669074 +0200
+++ llvm-3.7.0.src/tools/clang/lib/Driver/Tools.cpp	2015-07-28 13:26:09.853734065 +0200
@@ -604,7 +604,7 @@ StringRef tools::arm::getARMFloatABI(con
         FloatABI = "hard";
         break;
       case llvm::Triple::GNUEABI:
-        FloatABI = "softfp";
+        FloatABI = (Triple.getVendorName().equals("hardfloat") || Triple.getArchName().find('h')!=StringRef::npos) ? "hard" : "softfp";
         break;
       case llvm::Triple::EABIHF:
         FloatABI = "hard";
