--- llvm-3.7.0.src/lib/Support/Triple.cpp.detectHardfloat~	2015-06-04 21:15:05.000000000 +0200
+++ llvm-3.7.0.src/lib/Support/Triple.cpp	2015-06-05 00:35:14.633463522 +0200
@@ -405,8 +405,8 @@ static Triple::OSType parseOS(StringRef
     .Default(Triple::UnknownOS);
 }
 
-static Triple::EnvironmentType parseEnvironment(StringRef EnvironmentName) {
-  return StringSwitch<Triple::EnvironmentType>(EnvironmentName)
+static Triple::EnvironmentType parseEnvironment(StringRef EnvironmentName, StringRef ArchName, StringRef VendorName) {
+  Triple::EnvironmentType t = StringSwitch<Triple::EnvironmentType>(EnvironmentName)
     .StartsWith("eabihf", Triple::EABIHF)
     .StartsWith("eabi", Triple::EABI)
     .StartsWith("gnueabihf", Triple::GNUEABIHF)
@@ -419,6 +419,15 @@ static Triple::EnvironmentType parseEnvi
     .StartsWith("itanium", Triple::Itanium)
     .StartsWith("cygnus", Triple::Cygnus)
     .Default(Triple::UnknownEnvironment);
+  if(t == Triple::GNUEABI) {
+    // There's some special cases where -gnueabi actually means
+    // GNUEABIHF, such as
+    // armv7hl-linux-gnueabi (Fedora) and
+    // armv7a-hardfloat-linux-gnueabi (Gentoo)
+    if(ArchName.find('h') != StringRef::npos || VendorName.equals("hardfloat"))
+      return Triple::GNUEABIHF;
+  }
+  return t;
 }
 
 static Triple::ObjectFormatType parseFormat(StringRef EnvironmentName) {
@@ -542,7 +551,7 @@ Triple::Triple(const Twine &Str)
       SubArch(parseSubArch(getArchName())),
       Vendor(parseVendor(getVendorName())),
       OS(parseOS(getOSName())),
-      Environment(parseEnvironment(getEnvironmentName())),
+      Environment(parseEnvironment(getEnvironmentName(), getArchName(), getVendorName())),
       ObjectFormat(parseFormat(getEnvironmentName())) {
   if (ObjectFormat == Triple::UnknownObjectFormat)
     ObjectFormat = getDefaultFormat(*this);
@@ -577,7 +586,7 @@ Triple::Triple(const Twine &ArchStr, con
       SubArch(parseSubArch(ArchStr.str())),
       Vendor(parseVendor(VendorStr.str())),
       OS(parseOS(OSStr.str())),
-      Environment(parseEnvironment(EnvironmentStr.str())),
+      Environment(parseEnvironment(EnvironmentStr.str(), ArchStr.str(), VendorStr.str())),
       ObjectFormat(parseFormat(EnvironmentStr.str())) {
   if (ObjectFormat == Triple::UnknownObjectFormat)
     ObjectFormat = getDefaultFormat(*this);
@@ -610,7 +619,7 @@ std::string Triple::normalize(StringRef
   }
   EnvironmentType Environment = UnknownEnvironment;
   if (Components.size() > 3)
-    Environment = parseEnvironment(Components[3]);
+    Environment = parseEnvironment(Components[3], Components[0], Components[1]);
   ObjectFormatType ObjectFormat = UnknownObjectFormat;
   if (Components.size() > 4)
     ObjectFormat = parseFormat(Components[4]);
@@ -655,7 +664,7 @@ std::string Triple::normalize(StringRef
         Valid = OS != UnknownOS || IsCygwin || IsMinGW32;
         break;
       case 3:
-        Environment = parseEnvironment(Comp);
+        Environment = parseEnvironment(Comp, Components[0], Components[1]);
         Valid = Environment != UnknownEnvironment;
         if (!Valid) {
           ObjectFormat = parseFormat(Comp);
--- llvm-3.7.0.src/tools/clang/lib/Driver/Tools.cpp.detectHardfloat~	2015-06-05 00:35:14.628463526 +0200
+++ llvm-3.7.0.src/tools/clang/lib/Driver/Tools.cpp	2015-06-05 00:38:22.685215071 +0200
@@ -690,7 +690,7 @@ StringRef tools::arm::getARMFloatABI(con
         FloatABI = "hard";
         break;
       case llvm::Triple::GNUEABI:
-        FloatABI = "softfp";
+        FloatABI = (Triple.getVendorName().equals("hardfloat") || Triple.getArchName().find('h')!=StringRef::npos) ? "hard" : "softfp";
         break;
       case llvm::Triple::EABIHF:
         FloatABI = "hard";
@@ -7781,13 +7781,13 @@ static std::string getLinuxDynamicLinker
   else if (Arch == llvm::Triple::aarch64_be)
     return "/lib/ld-linux-aarch64_be.so.1";
   else if (Arch == llvm::Triple::arm || Arch == llvm::Triple::thumb) {
-    if (ToolChain.getTriple().getEnvironment() == llvm::Triple::GNUEABIHF)
+    if (ToolChain.getTriple().getEnvironment() == llvm::Triple::GNUEABIHF || (ToolChain.getTriple().getEnvironment() == llvm::Triple::GNUEABI && (ToolChain.getTriple().getVendorName().equals("hardfloat") || ToolChain.getTriple().getArchName().find('h')!=StringRef::npos)))
       return "/lib/ld-linux-armhf.so.3";
     else
       return "/lib/ld-linux.so.3";
   } else if (Arch == llvm::Triple::armeb || Arch == llvm::Triple::thumbeb) {
     // TODO: check which dynamic linker name.
-    if (ToolChain.getTriple().getEnvironment() == llvm::Triple::GNUEABIHF)
+    if (ToolChain.getTriple().getEnvironment() == llvm::Triple::GNUEABIHF || (ToolChain.getTriple().getEnvironment() == llvm::Triple::GNUEABI && (ToolChain.getTriple().getVendorName().equals("hardfloat") || ToolChain.getTriple().getArchName().find('h')!=StringRef::npos)))
       return "/lib/ld-linux-armhf.so.3";
     else
       return "/lib/ld-linux.so.3";
